#!/bin/bash

printUsage()
{
    cat <<HELPTEXT
Execute (/ source) COMMAND [ARG ...] with the environment variable DEBUG having
COMMAND added to it.
HELPTEXT
    echo
    printf 'Usage: %q %s\n' "$(basename "$1")" '[[-i|--interactive] .] COMMAND [ARG ...] [-?|-h|--help]'
}

isInteractive=
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
    --interactive|-i)	shift; isInteractive=t;;
esac

program=$1; shift
if [ "$program" = '.' ]; then
    program="$1"; shift
    if [ "$isInteractive" ]; then
	exec bash -i -c 'DEBUG+="${DEBUG:+,}$0"; . "$0" "$@"' -- "$program" "$@"
    fi

    BASH_ARGV0="$program"	# Bash 5+ only
    DEBUG+="${DEBUG:+,}${program}"
    . "$program" "$@"
    exit $?
fi

DEBUG+="${DEBUG:+,}${program}" exec "$program" "$@"
